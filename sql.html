<!DOCTYPE html>
<html>
<head>
    <title>SQL 인젝션 데모</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 40px; line-height: 1.6; }
        .container { max-width: 800px; margin: 0 auto; }
        input, button { padding: 8px; margin: 10px 0; }
        #result { border: 1px solid #ddd; padding: 15px; margin-top: 20px; }
        .vulnerable { color: red; font-weight: bold; }
        .safe { color: green; font-weight: bold; }
        pre { background: #f4f4f4; padding: 10px; overflow: auto; }
    </style>
</head>
<body>
    <div class="container">
        <h1>SQL 인젝션 데모</h1>
        <p>이 페이지는 SQL 인젝션 취약점을 시연하기 위한 데모입니다.</p>
        
        <h2>취약한 로그인 폼</h2>
        <form id="vulnerableForm">
            <div>
                <label>사용자명:</label>
                <input type="text" id="vulnUsername" placeholder="사용자명 입력">
            </div>
            <div>
                <label>비밀번호:</label>
                <input type="password" id="vulnPassword" placeholder="비밀번호 입력">
            </div>
            <button type="button" onclick="vulnerableLogin()">로그인</button>
        </form>
        
        <h2>안전한 로그인 폼</h2>
        <form id="safeForm">
            <div>
                <label>사용자명:</label>
                <input type="text" id="safeUsername" placeholder="사용자명 입력">
            </div>
            <div>
                <label>비밀번호:</label>
                <input type="password" id="safePassword" placeholder="비밀번호 입력">
            </div>
            <button type="button" onclick="safeLogin()">로그인</button>
        </form>
        
        <div id="result">
            <h3>결과</h3>
            <div id="queryResult"></div>
        </div>
        
        <div>
            <h2>시도해볼 SQL 인젝션</h2>
            <p>취약한 폼에서 다음과 같은 입력을 시도해보세요:</p>
            <pre>' OR '1'='1</pre>
            <p>사용자명에 위 코드를 입력하고 비밀번호는 아무거나 입력하세요.</p>
        </div>
    </div>

    <script>
        // 가상의 데이터베이스 테이블
        const users = [
            { id: 1, username: 'admin', password: 'secretpass123' },
            { id: 2, username: 'user1', password: 'userpass456' }
        ];
        
        // 취약한 로그인 함수
        function vulnerableLogin() {
            const username = document.getElementById('vulnUsername').value;
            const password = document.getElementById('vulnPassword').value;
            
            // SQL 인젝션에 취약한 쿼리 (시뮬레이션)
            const query = `SELECT * FROM users WHERE username = '${username}' AND password = '${password}'`;
            
            // 쿼리 실행 시뮬레이션
            let result = "";
            try {
                // 인젝션 시뮬레이션: ' OR '1'='1 같은 입력이 들어오면 모든 사용자 반환
                if (query.includes("' OR '1'='1")) {
                    result = `<div class="vulnerable">SQL 인젝션 성공!</div>
                             <p>실행된 쿼리: ${query}</p>
                             <p>결과: 모든 사용자 데이터가 노출됨</p>
                             <pre>${JSON.stringify(users, null, 2)}</pre>`;
                } else {
                    // 일반 로그인 시도 시뮬레이션
                    const user = users.find(u => u.username === username && u.password === password);
                    if (user) {
                        result = `<div>로그인 성공!</div>
                                 <p>실행된 쿼리: ${query}</p>
                                 <p>결과: 사용자 찾음</p>`;
                    } else {
                        result = `<div>로그인 실패</div>
                                 <p>실행된 쿼리: ${query}</p>
                                 <p>결과: 사용자를 찾을 수 없음</p>`;
                    }
                }
            } catch (e) {
                result = `<div>오류 발생: ${e.message}</div>`;
            }
            
            document.getElementById('queryResult').innerHTML = result;
        }
        
        // 안전한 로그인 함수
        function safeLogin() {
            const username = document.getElementById('safeUsername').value;
            const password = document.getElementById('safePassword').value;
            
            // 매개변수화된 쿼리 시뮬레이션
            const query = "SELECT * FROM users WHERE username = ? AND password = ?";
            
            // 쿼리 실행 시뮬레이션 (매개변수화된 방식)
            let result = "";
            try {
                // 실제 매개변수화된 쿼리는 SQL 인젝션을 방지함
                const user = users.find(u => u.username === username && u.password === password);
                if (user) {
                    result = `<div class="safe">안전한 로그인 성공!</div>
                             <p>실행된 쿼리: ${query}</p>
                             <p>바인딩된 매개변수: username="${username}", password="${password}"</p>
                             <p>결과: 사용자 찾음</p>`;
                } else {
                    result = `<div class="safe">안전한 로그인 실패</div>
                             <p>실행된 쿼리: ${query}</p>
                             <p>바인딩된 매개변수: username="${username}", password="${password}"</p>
                             <p>결과: 사용자를 찾을 수 없음</p>`;
                }
            } catch (e) {
                result = `<div>오류 발생: ${e.message}</div>`;
            }
            
            document.getElementById('queryResult').innerHTML = result;
        }
    </script>
</body>
</html>